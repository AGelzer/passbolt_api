.build-template:
  stage: test
  variables:
    PASSBOLT_FLAVOUR: pro
    UPSTREAM_COMMIT_SHA: pb-196
  trigger:
    # Gitlab doesnt support variable expansion in the project/branch fields
    # https://gitlab.com/gitlab-org/gitlab-ce/issues/58290
    #
    project: passbolt/passbolt_docker
    branch: feature/PB-196
  only:
    - feature/PB-196
  except:
    variables:
      - $PASSBOLT_FLAVOUR == "ce"

pro-trigger-build:
  extends: .build-template

ce-trigger-build:
  extends: .build-template
  variables:
    PASSBOLT_FLAVOUR: ce
    UPSTREAM_COMMIT_SHA: pb-196
  trigger:
    # Gitlab doesnt support variable expansion in the project/branch fields
    # https://gitlab.com/gitlab-org/gitlab-ce/issues/58290
    #
    project: passbolt/passbolt_docker
    branch: prerelease
  except:
    variables:
      - $PASSBOLT_FLAVOUR == "pro"
